<!doctype html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>Demo</title>
   
    <link type="text/css" href="css/smoothness/jquery-ui-1.8.13.custom.css" rel="stylesheet" />
    <link type="text/css" href="css/main.css" rel="stylesheet" />
    <script type="text/javascript" src="js/jquery-1.5.1.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui-1.8.13.custom.min.js"></script>
    <script type="text/javascript" src="js/jquery.validate.min.js"></script>
    <!--<script type="text/javascript" src="js/jquery.jstree.js"></script>-->
    <!--<script type="text/javascript" src="js/jquery.jlabel-1.3.min.js"></script>-->
    <!--<script type="text/javascript" src="js/jquery-idealForms.js"></script>-->
    <script type="text/javascript">
    
    	function generateCalenderColumns(col_idx) {
	    var hour=8;
	    var col_selection="ol#column_select" + col_idx;
	    for (; hour < 18; ++hour) {
		var list_item = "<li" + " id=col_" + col_idx + "_hour_" + hour + ">空闲</li>";
		$(list_item).appendTo(col_selection);
	    }
	    $(col_selection).find("li").addClass("ui-widget-content");
	}
	
	function generateLabResourcesForSelection() {
	    var labResource = [
		"SmartBits-6000C-Card-1A",
		"SmartBits-6000C-Card-1B",
		"Ixia-Port-1A"
	    ];
	    var select_lab_resources = $("select.lab_resource");
	    for (var idx = 0; idx < labResource.length; idx++)
	    {
		$('<option value="' + labResource[idx] + '">' + labResource[idx] + '</option>')
		    .appendTo(select_lab_resources);
	    }
	    select_lab_resources.find("option").addClass("ui-widget-content");
	}
	
        $(function(){ 
            //Tab control
	    var today_date = new Date();
	    $("span#reserve_date_info").data("date", today_date);
	    $("span#reserve_date_info").text(today_date.toDateString());
	    //selected_column, save the selected selectable column object
	    var selected_column = null;
            $(".selection").selectable( {
		//selecting event hanlder
		//make sure only one day is select
		selecting: function() {
		    if (selected_column) {
			$(".ui-selected", selected_column).removeClass("ui-selected");
			selected_column = null;
		    }
		},
		stop: function() {
		    if ( $(".ui-selected", this).length > 0) {
			$("#reserve").button("enable");
			selected_column = this;			
		    }
		}
	    });
	    
	    // From 8:00 to 18:00, 10hours
	    for (var hour=8; hour < 18; hour++){
		//Generate the left-most time slot info
		$('<li>' + hour + ":00" + "</li>").appendTo("ol#daytime");
		//Generate the starttime and endtime select options for reserve form
		$('<option value="' + hour + '">' + hour + ':00</option>').appendTo("select#starttime");
		//Let the endtime to be generated by trigger change event later
	    }
	    $("ol#daytime").find("li").addClass("ui-widget-content");
	    
	    
	    for (var col_idx=1; col_idx <= 7; col_idx++) {
		generateCalenderColumns(col_idx);
	    }
	    generateLabResourcesForSelection();
	    //set regional of datepicker to zh-CN
	    //$.datepicker.setDefaults( $.datepicker.regional[ "zh-CN" ] );

	    $("#selectdate").datepicker({
		dateFormat: "yy-mm-dd",	//ISO date format
		autoSize: true,
		showOtherMonths: true		
	    });
	    
	    $("button#reserve")
		.button( { disabled: true } )
		.click( function() {		    
		    $("#reserve_form").dialog("open");
		});  
		    
	    $("#reserve_form").dialog( {
		autoOpen: false,
		height: 500,
		width: 550,
		modal: true,
		buttons: {
		    Cancel: function() {
			$(this).dialog("close");
		    }
		},
		open: function() {
		   //	 alert("Open form");
		  $("form#reserve").valid();  
		},
		close: function() {
		    //allFields.val( "" ).removeClass( "ui-state-error" );
		}
	    });
	    
	    $("form#reserve").validate({
		rules: {
		    name: {
			required: true,
			minlength: 2
		    },
		    email: {
			required: true,
			email: true
		    },
		    sel_reserve_date: {
			required: true,
			dateISO: true
		    },
		    starttime: {
			required: true
		    },
		    endtime: {
			required: true,
		    },
		    resource: {
			required: true
		    }		    
		},
		success: function(label) {
		    //We want to show a green check icon for success
		    //Note need to operate on the child of label
		    $('<span></span>').appendTo(label);
		    label
			.find("span")
			.addClass("ui-icon ui-icon-check")
			.css("display", "inline-block");
		}
	    });
	    
	    //Register change event hanlder for starttime select
	    $("select#starttime").change(function(){
		//alert("Selected: " + $("option:selected", this).attr("value"));
		//Get the value of selected starttime
		var starttime = $("option:selected", this).attr("value");
		$("select#endtime").empty();
		for (var endtime = parseInt(starttime) + 1; endtime <= 18; ++endtime) {
		    $('<option value="' + endtime + '">' + endtime + ':00</option>').appendTo("select#endtime");		    
		}
		$("form#reserve").validate().element('select#starttime');
	    });
	    
	    $("#sel_reserve_date").datepicker({
		    autoSize: true,
		    dateFormat: "yy-mm-dd",
		    onClose: function() {
			$("form#reserve").validate().element("#sel_reserve_date");
		    }
		})
		.addClass("ui-corner-all");
	    
	    //trigger change event
	    $("select#starttime").change();
        });

    </script>
    </head>
    <body>	
	<div id="top_container" class="purple_border">
	    <div id="header">
		<table border="0">
		    <tr>
			<td>
			    <img src="images/QCA_Logo.gif" alt="QCA_Logo" align="left"/>
			</td>
			<td>
			    <h2 class="header">
				AE Lab Resource Reservation</h2>
			</td>
		    </tr>
		</table>
	    </div>
	    <div id="resource_container" class="purple_border">
		<form id="resource_form">
		    <fieldset id="resource_fieldset">
			<legend>日期和实验室资源</legend>
			<p>
			<div id="selectdate">			   
			</div>
			</p>
			<p>
			<div id="lab_resource">
			<label>实验室资源<span id="view_lab_resource"></span></label>
			<select title="Select Lab Resource" id="select_lab_resource" class="lab_resource ui-widget ui-corner-all">
			</select>
			</div>
			</p>
		    </fieldset>
		</form>
	    </div>
	    
	    <div id="calender" class="purple_border">
		<div id="calender_header" class="purple_border">
		<p>实验室资源 -> <span id="reserve_lab_resource">none</span>, 选定日期 -> <span id="reserve_date_info">none</span></p>
		</div>
		<div id="calender_content" class="purple_border">
		    <table id="calender_table">
			<tr id="weekday_header">
			    <th class="first_col"></th>
			    <th>Sun</th>
			    <th>Mon</th>
			    <th>Tue</th>
			    <th>Wed</th>
			    <th>Thu</th>
			    <th>Fri</th>
			    <th>Sat</th>
			</tr>
			<tr id="calender_rows">
			    <td class="first_col">
				<div id="col_header" class="calender_column">
				<ol id="daytime"> 
				</ol>
				</div>
			    </td>
			    <td>
				<div id="column1" class="calender_column column_center">
				    <ol id="column_select1" class="selection">
				    </ol>
				</div>
			    </td>
			    <td>
				<div id="column2" class="calender_column column_center">
				    <ol id="column_select2" class="selection">
				    </ol>
				</div>
			    </td>
			    <td>
				<div id="column3" class="calender_column column_center">
				<ol id="column_select3" class="selection">
				    
				</ol>
				</div>
			    </td>
			    <td>
				<div id="column4" class="calender_column column_center">
				    <ol id="column_select4" class="selection">
				    </ol>
				</div>
			    </td>
			    <td>
				<div id="column5" class="calender_column column_center">
				    <ol id="column_select5" class="selection">
				    </ol>
				</div>
			    </td>
			    <td>
				<div id="column6" class="calender_column column_center">
				    <ol id="column_select6" class="selection">
				    </ol>
				</div>
			    </td>
			    <td>
				<div id="column7" class="calender_column column_center">
				    <ol id="column_select7" class="selection">
				    </ol>
				</div>
			    </td>
			</tr>
		    </table>
		</div>
		<div id="reservation_container">
		    <button id="reserve">预定资源</button>
		</div>
		<div id="reserve_form" title="预定资源">
		    <form id="reserve">
			<legend class="ui-widget ui-widget-header ui-corner-all">填写下列信息</legend>
			<fieldset class="ui-widget ui-widget-content ui-corner-all">
			    <table>
			    <tr>
				<td><label for="name">姓名:</label></td>
				<td>
				    <input type="text" name="name" id="name" class="ui-widget-content ui-corner-all" />
				</td>
			    </tr>
			    <tr>
				<td>
				    <label for="email">电子邮件:</label>
				</td>
				<td>
				    <input type="text" name="email" id="email" value="" class="ui-widget-content ui-corner-all" />
				</td>
			    </tr>
			    <tr>
				<td><label for="sel_reserve_date">日期:</label></td>
				<td>
				    <input type="text" name="sel_reserve_date" id="sel_reserve_date" value=""/>				   
				</td>
			    </tr>
			    <tr>
				<td>
				    <label for="starttime">开始时间:</label>
				</td>
				<td>
				    <select name="starttime" id="starttime" class="daytime ui-widget ui-corner-all">
				    </select>
				</td>
			    </tr>
			    <tr>
				<td>
				    <label for="endtime">结束时间:</label>
				</td>
				<td>
				    <select name="endtime" id="endtime" class="daytime ui-widget ui-corner-all">
				    </select>
				</td>
			    </tr>
			    <tr>
				<td>
				    <label for="resource">实验室资源:</label>
				</td>
				<td>
				<select id="resource" name="resource" class="lab_resource ui-widget ui-corner-all">				
				</select>
				</td>
			    </tr>
			    <tr>
				<td>
				    <label for="comment">备注(可选):</label>
				</td>
				<td>
				    <textarea id="comment"></textarea>
				</td>
			    </tr>
			    </table>
			</fieldset>
		    </form>
		</div>
		</div>
	</div>
    </body>
</html>
